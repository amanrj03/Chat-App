generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  phoneNumber   String         @unique
  name          String
  password      String
  publicKey     String?
  profilePicture String?
  dateOfBirth   DateTime?
  gender        String?
  bio           String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  sentMessages     Message[]      @relation("SentMessages")
  receivedMessages Message[]      @relation("ReceivedMessages")
  blockedUsers     BlockedUser[]  @relation("BlockingUser")
  blockedByUsers   BlockedUser[]  @relation("BlockedUser")
  chatList1        ChatList[]     @relation("User1Chats")
  chatList2        ChatList[]     @relation("User2Chats")
}

model Message {
  id         String   @id @default(uuid())
  content    String
  senderId   String
  receiverId String
  createdAt  DateTime @default(now())
  isRead     Boolean  @default(false)
  
  sender   User @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  
  @@index([senderId, receiverId])
}

model BlockedUser {
  id          String   @id @default(uuid())
  blockerId   String
  blockedId   String
  createdAt   DateTime @default(now())
  
  blocker User @relation("BlockingUser", fields: [blockerId], references: [id], onDelete: Cascade)
  blocked User @relation("BlockedUser", fields: [blockedId], references: [id], onDelete: Cascade)
  
  @@unique([blockerId, blockedId])
}

model ChatList {
  id                  String   @id @default(uuid())
  user1Id             String
  user2Id             String
  lastMessage         String?
  lastMessageSenderId String?
  updatedAt           DateTime @updatedAt
  
  user1 User @relation("User1Chats", fields: [user1Id], references: [id], onDelete: Cascade)
  user2 User @relation("User2Chats", fields: [user2Id], references: [id], onDelete: Cascade)
  
  @@unique([user1Id, user2Id])
}